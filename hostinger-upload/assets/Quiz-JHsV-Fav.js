import{j as e,B as s,d as t,h as r,f as a}from"./ui-BdcIL076.js";import{r as n,h as l,d as i}from"./vendor-rodsj_b4.js";import{l as o,s as c,C as d,q as m,B as x,x as u}from"./index-Ds1ZkD-9.js";const h=({lessonId:a,onComplete:l})=>{const[i,u]=n.useState([]),[h,p]=n.useState(0),[b,j]=n.useState(null),[f,g]=n.useState(!1),[N,v]=n.useState(0),[y,w]=n.useState(!0),[q]=n.useState(Date.now()),{toast:_}=o();n.useEffect(()=>{S()},[a]);const S=async()=>{try{const{data:e}=await c.from("chunks").select("id").eq("lesson_id",a);if(!e||0===e.length)return _({title:"Sem questÃµes disponÃ­veis",description:"Ainda nÃ£o hÃ¡ questÃµes para esta liÃ§Ã£o.",variant:"destructive"}),void w(!1);const s=e.map(e=>e.id),{data:t,error:r}=await c.from("questions").select("*").in("chunk_id",s).limit(10);if(r)throw r;u(t||[])}catch(e){_({title:"Erro ao carregar questÃµes",description:"Tente novamente mais tarde.",variant:"destructive"})}finally{w(!1)}};if(y)return e.jsx("div",{className:"text-center py-8",children:"Carregando questÃµes..."});if(0===i.length)return e.jsxs(d,{className:"p-8 text-center",children:[e.jsx(s,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"QuestÃµes em desenvolvimento. Volte em breve!"})]});const k=i[h],C=(h+1)/i.length*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["QuestÃ£o ",h+1," de ",i.length]}),e.jsxs("span",{className:"text-primary font-semibold",children:["Acertos: ",N]})]}),e.jsx(m,{value:C,className:"h-2"})]}),e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:k.prompt}),e.jsx("div",{className:"space-y-3",children:k.alternatives.map((s,a)=>{const n=a===k.correct_index,l=a===b;let o="w-full text-left p-4 rounded-xl border-2 transition-all ";return o+=f?n?"border-green-500 bg-green-500/10":l&&!n?"border-red-500 bg-red-500/10":"border-border opacity-50":"border-border hover:border-primary hover:bg-primary/5 cursor-pointer",e.jsx("button",{onClick:()=>(e=>{f||(j(e),g(!0),e===i[h].correct_index&&v(N+1))})(a),className:o,disabled:f,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:s.text}),f&&e.jsx("span",{children:n?e.jsx(t,{className:"h-5 w-5 text-green-500"}):l?e.jsx(r,{className:"h-5 w-5 text-red-500"}):null})]})},a)})}),f&&k.explanation&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-primary/10 border border-primary/20",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"ðŸ’¡ ExplicaÃ§Ã£o:"}),e.jsx("p",{className:"text-sm",children:k.explanation})]}),f&&e.jsx(x,{onClick:async()=>{if(h<i.length-1)p(h+1),j(null),g(!1);else{const s=Math.floor((Date.now()-q)/1e3);try{const{data:{user:e}}=await c.auth.getUser();e&&await c.from("quiz_results").insert({user_id:e.id,lesson_id:a,score:N,total_questions:i.length,time_spent_seconds:s})}catch(e){}l&&l(N,i.length),_({title:"ðŸŽ‰ Quiz concluÃ­do!",description:`VocÃª acertou ${N} de ${i.length} questÃµes (${Math.round(N/i.length*100)}%)`})}},className:"w-full mt-4 btn-premium",children:h<i.length-1?"PrÃ³xima QuestÃ£o":"Finalizar Quiz"})]})]})},p=()=>{const{lessonId:s}=l(),t=i(),r=u();return e.jsxs("div",{className:"min-h-screen bg-background",children:[!r&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200 text-yellow-800 text-sm p-2 text-center",children:"VocÃª estÃ¡ offline. O quiz pode limitar salvar progresso."}),e.jsx("header",{className:"border-b border-border bg-card/50 backdrop-blur-sm",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between px-4 py-4",children:[e.jsxs("button",{onClick:()=>t(-1),className:"flex items-center gap-2 text-foreground hover:text-primary",children:[e.jsx(a,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"Voltar"})]}),e.jsx("h1",{className:"text-xl font-bold",children:e.jsx("span",{className:"text-gold",children:"Quiz - Pratique"})}),e.jsx("div",{className:"w-20"})]})}),e.jsx("div",{className:"container mx-auto max-w-3xl px-4 py-12",children:e.jsx(h,{lessonId:s||"",onComplete:()=>{t("/tabs")}})})]})};export{p as default};

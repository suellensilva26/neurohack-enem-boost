import{j as e,f as s,A as a,T as r,e as t,l}from"./ui-BdcIL076.js";import{r as i,d,L as o}from"./vendor-rodsj_b4.js";import{l as c,x as n,s as m,C as x,B as u,q as h}from"./index-Ds1ZkD-9.js";const p=()=>{const p=!0,[b,j]=i.useState([]),[N,f]=i.useState(0),[g,y]=i.useState([]),[v,w]=i.useState(!1),[C,S]=i.useState(0),[k]=i.useState(Date.now()),[q,_]=i.useState(!1),[V,A]=i.useState(!0),{toast:T}=c(),E=d(),M=n();i.useEffect(()=>{P()},[]);const P=async()=>{try{const{data:{user:e}}=await m.auth.getUser();e||_(!0);const{data:s}=await m.from("profiles").select("entitlements").eq("id",e?.id).single(),a=p;_(a);const{data:r,error:t}=await m.from("questions").select("*").eq("priority",!0).limit(a?100:10);if(t)throw t;j(r||[]),y(new Array(r?.length||0).fill(-1))}catch(e){T({title:"Erro ao carregar simulado",description:"Tente novamente mais tarde",variant:"destructive"})}finally{A(!1)}};if(V)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Carregando simulado..."})});if(v){const i=g.reduce((e,s,a)=>e+(s===b[a]?.correct_index?1:0),0),d=i/b.length*100;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card/50 backdrop-blur-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs(o,{to:"/tabs",className:"flex items-center gap-2 text-foreground hover:text-primary",children:[e.jsx(s,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"Voltar"})]})})}),e.jsx("div",{className:"container mx-auto max-w-4xl px-4 py-12",children:e.jsxs(x,{className:"card-premium text-center",children:[e.jsx(a,{className:"h-16 w-16 text-gold mx-auto mb-4"}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Simulado Conclu√≠do!"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx(r,{className:"h-8 w-8 text-primary mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-primary",children:[i,"/",b.length]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Quest√µes Corretas"})]}),e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx(t,{className:"h-8 w-8 text-primary mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-primary",children:[d.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Aproveitamento"})]}),e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx(l,{className:"h-8 w-8 text-primary mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-primary",children:[Math.floor(C/60),"min"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Tempo Total"})]})]}),!q&&e.jsxs("div",{className:"bg-gold/10 border border-gold/30 rounded-xl p-6 mb-6",children:[e.jsx("p",{className:"text-foreground mb-4",children:"Voc√™ completou o teste demo! Desbloqueie as 100 quest√µes completas e relat√≥rios detalhados."}),e.jsx(u,{className:"btn-premium",onClick:()=>setShowPaywall(!0),children:"Ver Planos Premium"})]}),e.jsxs("div",{className:"space-y-4 text-left",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"üìä Recomenda√ß√µes de Estudo"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"‚Ä¢ Revise as quest√µes de Matem√°tica - √°rea com maior √≠ndice de erros"}),e.jsx("li",{children:"‚Ä¢ Estude os t√≥picos de Interpreta√ß√£o de Texto para melhorar 15%"}),e.jsx("li",{children:"‚Ä¢ Foque em Ci√™ncias da Natureza nos pr√≥ximos 7 dias"})]})]}),e.jsx(u,{className:"mt-6 w-full",onClick:()=>E("/tabs"),children:"Voltar para as Abas"})]})})]})}const z=(N+1)/b.length*100;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card/50 backdrop-blur-sm",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between px-4 py-4",children:[e.jsxs("button",{onClick:()=>E(-1),className:"flex items-center gap-2 text-foreground hover:text-primary",children:[e.jsx(s,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"Voltar"})]}),e.jsx("h1",{className:"text-xl font-bold",children:e.jsx("span",{className:"text-gold",children:"Simulado"})}),e.jsx("div",{className:"w-20"})]})}),!M&&e.jsx("div",{className:"bg-yellow-50 border-y border-yellow-200 text-yellow-800 text-sm p-2 text-center",children:"Voc√™ est√° offline. O simulado pode necessitar conex√£o para carregar e salvar."}),e.jsxs("div",{className:"container mx-auto max-w-4xl px-4 py-8",children:[e.jsx(h,{value:z,className:"mb-8"}),b[N]&&e.jsxs(x,{className:"card-premium",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex gap-2 mb-4",children:b[N].tags?.map((s,a)=>e.jsx("span",{className:"text-xs bg-primary/20 text-primary px-3 py-1 rounded-full",children:s},a))}),e.jsx("p",{className:"text-lg text-foreground whitespace-pre-wrap",children:b[N].prompt})]}),e.jsx("div",{className:"space-y-3",children:b[N].alternatives?.map((s,a)=>e.jsxs("button",{onClick:()=>(e=>{const s=[...g];s[N]=e,y(s),N<b.length-1&&f(N+1)})(a),className:"w-full text-left p-4 rounded-xl border transition-all "+(g[N]===a?"border-primary bg-primary/20":"border-border hover:border-primary/50 hover:bg-card"),children:[e.jsxs("span",{className:"font-semibold text-primary mr-3",children:[String.fromCharCode(65+a),")"]}),s]},a))}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsx(u,{variant:"outline",onClick:()=>f(Math.max(0,N-1)),disabled:0===N,children:"Anterior"}),N===b.length-1?e.jsx(u,{onClick:async()=>{const e=Math.floor((Date.now()-k)/1e3);S(e);const s=g.reduce((e,s,a)=>e+(s===b[a]?.correct_index?1:0),0);try{const{data:{user:a}}=await m.auth.getUser();a&&await m.from("quiz_results").insert({user_id:a.id,lesson_id:"simulado-100",score:s/b.length*100,total_questions:b.length,time_spent_seconds:e})}catch(a){}w(!0)},children:"Finalizar Simulado"}):e.jsx(u,{onClick:()=>f(N+1),disabled:-1===g[N],children:"Pr√≥xima"})]})]})]})]})};export{p as default};

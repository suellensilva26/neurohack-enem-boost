import{j as e,d as s,h as a,l as t,w as i}from"./ui-BdcIL076.js";import{r}from"./vendor-rodsj_b4.js";import{n,C as l,o as c,p as o,m as d,B as m,D as x}from"./index-Ds1ZkD-9.js";import{I as u}from"./InstallBanner-qjrO3Xh0.js";const h="https://api.enem.dev/v1",p=new Map,j=()=>{const[e,s]=r.useState(!1),[a,t]=r.useState(null),[i,n]=r.useState([]),l=e=>{const s=p.get(e);return s&&Date.now()-s.timestamp<18e5?s.data:null},c=(e,s)=>{p.set(e,{data:s,timestamp:Date.now()})},o=r.useCallback(async e=>{const a=(e=>JSON.stringify(e))(e),i=l(a);if(i)return n(i),i;s(!0),t(null);try{const s=new URLSearchParams;e.year&&s.append("year",e.year.toString()),e.discipline&&s.append("discipline",e.discipline),e.limit&&s.append("limit",e.limit.toString()),e.competence&&s.append("competence",e.competence),e.skill&&s.append("skill",e.skill);const t=await fetch(`${h}/questions?${s}`);if(!t.ok)throw new Error(`Erro na API: ${t.status}`);const i=(await t.json()).map((s,a)=>({id:s.id||`q_${e.year}_${a}`,enunciado:s.statement||s.enunciado||"",alternatives:s.alternatives||s.alternativas||[],correctAnswer:s.correctAnswer||s.gabarito||0,year:s.year||e.year||2023,discipline:s.discipline||e.discipline||"geral",competence:s.competence||s.competencia,skill:s.skill||s.habilidade,image:s.image||s.imagem,context:s.context||s.contexto}));return n(i),c(a,i),i}catch(r){const e=r instanceof Error?r.message:"Erro desconhecido";return t(e),[]}finally{s(!1)}},[]),d=r.useCallback(async e=>{const{ano:s,disciplina:a,tipo:t,limite:i}=e;let r=[],n=0,l=0;try{if("completo"===t){const e=["matematica","ciencias-natureza","ciencias-humanas","linguagens"];n=330,l=180;for(const a of e){const e=await o({year:s,discipline:a,limit:45});r.push(...e.slice(0,45))}}else if("por_disciplina"===t&&a)n=90,l=45,r=await o({year:s,discipline:a,limit:45});else if("personalizado"===t){const e=i||20;n=Math.ceil(2.5*e),l=e,r=await o({year:s,discipline:a,limit:e})}const e=r.sort(()=>Math.random()-.5).slice(0,l);return{id:`simulado_${s}_${t}_${Date.now()}`,titulo:a?`ENEM ${s} - ${a.charAt(0).toUpperCase()+a.slice(1)}`:`ENEM ${s} - Simulado ${"completo"===t?"Completo":"Personalizado"}`,ano:s,disciplina:a,questoes:e,tempoLimite:n,tipo:t,totalQuestoes:e.length}}catch(c){throw new Error("Falha ao gerar simulado")}},[o]),m=r.useCallback(async()=>{const e="anos_disponiveis",s=l(e);if(s)return s;try{const s=await fetch(`${h}/exams`);if(!s.ok)throw new Error("Erro ao buscar anos");const a=(await s.json()).map(e=>e.year).sort((e,s)=>s-e);return c(e,a),a}catch(a){return[2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009]}},[]),x=r.useCallback(async()=>["matematica","ciencias-natureza","ciencias-humanas","linguagens"],[]);return{loading:e,error:a,questoes:i,buscarQuestoes:o,gerarSimulado:d,listarAnos:m,listarDisciplinas:x}},g={matematica:"Matemática","ciencias-natureza":"Ciências da Natureza","ciencias-humanas":"Ciências Humanas",linguagens:"Linguagens"};function f(){const{loading:h,error:p,questoes:f,buscarQuestoes:N,listarAnos:b,listarDisciplinas:v}=j(),[w,y]=r.useState(0),[C,S]=r.useState(null),[E,A]=r.useState(!1),[k,$]=r.useState(0),[M,z]=r.useState(0),[q,D]=r.useState([]),[Q,_]=r.useState([]),[L,I]=r.useState({ano:void 0,disciplina:void 0,limite:20}),P=120,[B,F]=r.useState(P);r.useEffect(()=>{(async()=>{const e=await b(),s=await v();D(e),_(s);const a=e?.[0],t=s?.[0];I(e=>({...e,ano:a,disciplina:t})),await N({year:a,discipline:t,limit:L.limite}),y(0),F(P),S(null),A(!1),$(0),z(0)})()},[]),r.useEffect(()=>{if(B>0&&!E){const e=setTimeout(()=>F(e=>e-1),1e3);return()=>clearTimeout(e)}0!==B||E||(z(e=>e+1),A(!0))},[B,E]);const R=f[w];return e.jsxs("div",{className:"min-h-screen bg-background p-6",children:[k+M>=10&&e.jsx(u,{}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Banco de Questões ENEM"}),e.jsx("p",{className:"text-muted-foreground",children:f.length>0?`Questão ${w+1} de ${f.length}`:"Carregue as questões pelos filtros abaixo"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(n,{variant:"outline",className:"text-lg",children:[e.jsx(s,{className:"mr-2 h-4 w-4 text-green-600"}),k," acertos"]}),e.jsxs(n,{variant:"outline",className:"text-lg",children:[e.jsx(a,{className:"mr-2 h-4 w-4 text-red-600"}),M," erros"]})]})]}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(o,{children:"Filtros"})}),e.jsxs(d,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Ano"}),e.jsx("select",{className:"w-full p-2 border rounded-md",value:L.ano??"",onChange:e=>I({...L,ano:Number(e.target.value)}),children:q.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Disciplina"}),e.jsx("select",{className:"w-full p-2 border rounded-md",value:L.disciplina??"",onChange:e=>I({...L,disciplina:e.target.value}),children:Q.map(s=>e.jsx("option",{value:s,children:g[s]??s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Limite"}),e.jsx("input",{type:"number",min:5,max:100,value:L.limite,className:"w-full p-2 border rounded-md",onChange:e=>I({...L,limite:Number(e.target.value)})})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(m,{className:"w-full",onClick:async()=>{await N({year:L.ano,discipline:L.disciplina,limit:L.limite}),y(0),F(P),S(null),A(!1),$(0),z(0)},disabled:h,children:h?"Carregando...":"Carregar Questões"})})]}),p&&e.jsxs("p",{className:"text-sm text-destructive mt-2",children:["Erro ao carregar: ",p]})]})]}),R&&e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(n,{variant:"outline",children:g[R.discipline]||"Geral"}),e.jsxs(n,{variant:"secondary",children:["ENEM ",R.year]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-bold "+(B<=30?"text-red-600":""),children:[B,"s"]})]})]})}),e.jsxs(d,{className:"space-y-6",children:[e.jsxs("div",{className:"prose max-w-none",children:[e.jsx("h3",{className:"text-lg font-medium leading-relaxed",children:R.enunciado}),R.context&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:R.context})]}),R.image&&e.jsx("img",{src:R.image,alt:"Imagem da questão",className:"rounded-lg border"}),e.jsx("div",{className:"space-y-3",children:(R.alternatives||[]).map((t,i)=>e.jsx(m,{variant:"outline",className:"w-full justify-start h-auto p-4 text-left "+(E?i===R.correctAnswer?"border-green-500 bg-green-50 text-green-800":C===i?"border-red-500 bg-red-50 text-red-800":"":C===i?"border-primary bg-primary/10":"hover;border-primary/50"),onClick:()=>!E&&S(i),disabled:E,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center text-sm font-medium "+(E?i===R.correctAnswer?"border-green-500 bg-green-500 text-white":C===i?"border-red-500 bg-red-500 text-white":"border-gray-300":C===i?"border-primary bg-primary text-white":"border-gray-300"),children:String.fromCharCode(65+i)}),e.jsx("span",{className:"flex-1",children:t}),E&&i===R.correctAnswer&&e.jsx(s,{className:"h-5 w-5 text-green-600"}),E&&C===i&&i!==R.correctAnswer&&e.jsx(a,{className:"h-5 w-5 text-red-600"})]})},i))}),E&&e.jsx(l,{className:"border-primary/20 bg-primary/5",children:e.jsxs(d,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold text-primary mb-2",children:"Gabarito:"}),e.jsxs("p",{className:"text-foreground",children:["Letra ",String.fromCharCode(65+(R.correctAnswer??0))," — ",(R.alternatives||[])[R.correctAnswer??0]||"Alternativa"]})]})}),e.jsxs("div",{className:"flex gap-3",children:[E?e.jsx(m,{onClick:()=>{if(w<f.length-1){y(w+1),S(null),A(!1),F(P)}else{const e=k+(C===f[w]?.correctAnswer?1:0);x.success("Sessão finalizada!",{description:`Acertos: ${e}, Erros: ${M}`})}},className:"flex-1",children:w<f.length-1?"Próxima Questão":"Finalizar Sessão"}):e.jsx(m,{onClick:()=>{if(null===C)return;const e=f[w];e&&(C===e.correctAnswer?$(e=>e+1):z(e=>e+1),A(!0))},disabled:null===C,className:"flex-1",children:"Responder"}),e.jsx(m,{variant:"outline",onClick:()=>{y(0),S(null),A(!1),$(0),z(0),F(P)},children:"Reiniciar"})]})]})]}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(o,{children:"Estatísticas da Sessão"})}),e.jsx(d,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(s,{className:"h-8 w-8 mx-auto mb-2 text-green-600"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:k}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Acertos"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(a,{className:"h-8 w-8 mx-auto mb-2 text-red-600"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:M}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Erros"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(i,{className:"h-8 w-8 mx-auto mb-2 text-primary"}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[k+M>0?Math.round(k/(k+M)*100):0,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Taxa de Acerto"})]})]})})]})]})]})}export{f as default};

import{j as e,f as s,A as a,T as r,e as t,l}from"./ui-CrYyYaxT.js";import{r as i,d,L as o}from"./vendor-rodsj_b4.js";import{l as c,s as n,C as m,B as x,q as u}from"./index-BzZWAwwb.js";const h=()=>{const h=!0,[p,j]=i.useState([]),[b,g]=i.useState(0),[N,f]=i.useState([]),[v,y]=i.useState(!1),[w,C]=i.useState(0),[S]=i.useState(Date.now()),[k,q]=i.useState(!1),[_,A]=i.useState(!0),{toast:T}=c(),V=d();i.useEffect(()=>{E()},[]);const E=async()=>{try{const{data:{user:e}}=await n.auth.getUser();e||q(!0);const{data:s}=await n.from("profiles").select("entitlements").eq("id",e?.id).single(),a=h;q(a);const{data:r,error:t}=await n.from("questions").select("*").eq("priority",!0).limit(a?100:10);if(t)throw t;j(r||[]),f(new Array(r?.length||0).fill(-1))}catch(e){T({title:"Erro ao carregar simulado",description:"Tente novamente mais tarde",variant:"destructive"})}finally{A(!1)}};if(_)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Carregando simulado..."})});if(v){const i=N.reduce((e,s,a)=>e+(s===p[a]?.correct_index?1:0),0),d=i/p.length*100;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card/50 backdrop-blur-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs(o,{to:"/tabs",className:"flex items-center gap-2 text-foreground hover:text-primary",children:[e.jsx(s,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"Voltar"})]})})}),e.jsx("div",{className:"container mx-auto max-w-4xl px-4 py-12",children:e.jsxs(m,{className:"card-premium text-center",children:[e.jsx(a,{className:"h-16 w-16 text-gold mx-auto mb-4"}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Simulado Conclu√≠do!"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx(r,{className:"h-8 w-8 text-primary mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-primary",children:[i,"/",p.length]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Quest√µes Corretas"})]}),e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx(t,{className:"h-8 w-8 text-primary mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-primary",children:[d.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Aproveitamento"})]}),e.jsxs("div",{className:"bg-primary/10 rounded-xl p-6",children:[e.jsx(l,{className:"h-8 w-8 text-primary mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-primary",children:[Math.floor(w/60),"min"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Tempo Total"})]})]}),!k&&e.jsxs("div",{className:"bg-gold/10 border border-gold/30 rounded-xl p-6 mb-6",children:[e.jsx("p",{className:"text-foreground mb-4",children:"Voc√™ completou o teste demo! Desbloqueie as 100 quest√µes completas e relat√≥rios detalhados."}),e.jsx(x,{className:"btn-premium",onClick:()=>setShowPaywall(!0),children:"Ver Planos Premium"})]}),e.jsxs("div",{className:"space-y-4 text-left",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"üìä Recomenda√ß√µes de Estudo"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"‚Ä¢ Revise as quest√µes de Matem√°tica - √°rea com maior √≠ndice de erros"}),e.jsx("li",{children:"‚Ä¢ Estude os t√≥picos de Interpreta√ß√£o de Texto para melhorar 15%"}),e.jsx("li",{children:"‚Ä¢ Foque em Ci√™ncias da Natureza nos pr√≥ximos 7 dias"})]})]}),e.jsx(x,{className:"mt-6 w-full",onClick:()=>V("/tabs"),children:"Voltar para as Abas"})]})})]})}const M=(b+1)/p.length*100;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card/50 backdrop-blur-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{to:"/tabs",className:"flex items-center gap-2 text-foreground hover:text-primary",children:[e.jsx(s,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"Voltar"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Quest√£o ",b+1," de ",p.length]})})]})})}),e.jsxs("div",{className:"container mx-auto max-w-4xl px-4 py-8",children:[e.jsx(u,{value:M,className:"mb-8"}),p[b]&&e.jsxs(m,{className:"card-premium",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex gap-2 mb-4",children:p[b].tags?.map((s,a)=>e.jsx("span",{className:"text-xs bg-primary/20 text-primary px-3 py-1 rounded-full",children:s},a))}),e.jsx("p",{className:"text-lg text-foreground whitespace-pre-wrap",children:p[b].prompt})]}),e.jsx("div",{className:"space-y-3",children:p[b].alternatives?.map((s,a)=>e.jsxs("button",{onClick:()=>(e=>{const s=[...N];s[b]=e,f(s),b<p.length-1&&g(b+1)})(a),className:"w-full text-left p-4 rounded-xl border transition-all "+(N[b]===a?"border-primary bg-primary/20":"border-border hover:border-primary/50 hover:bg-card"),children:[e.jsxs("span",{className:"font-semibold text-primary mr-3",children:[String.fromCharCode(65+a),")"]}),s]},a))}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsx(x,{variant:"outline",onClick:()=>g(Math.max(0,b-1)),disabled:0===b,children:"Anterior"}),b===p.length-1?e.jsx(x,{onClick:async()=>{const e=Math.floor((Date.now()-S)/1e3);C(e);const s=N.reduce((e,s,a)=>e+(s===p[a]?.correct_index?1:0),0);try{const{data:{user:a}}=await n.auth.getUser();a&&await n.from("quiz_results").insert({user_id:a.id,lesson_id:"simulado-100",score:s/p.length*100,total_questions:p.length,time_spent_seconds:e})}catch(a){}y(!0)},children:"Finalizar Simulado"}):e.jsx(x,{onClick:()=>g(b+1),disabled:-1===N[b],children:"Pr√≥xima"})]})]})]})]})};export{h as default};

import{j as e,d as s,h as a,l as t,v as r}from"./ui-CrYyYaxT.js";import{r as i}from"./vendor-rodsj_b4.js";import{n,C as l,o as c,p as o,m as d,B as m}from"./index-BzZWAwwb.js";import{I as x}from"./InstallBanner-R55xnNJ9.js";const u="https://api.enem.dev/v1",h=new Map,p=()=>{const[e,s]=i.useState(!1),[a,t]=i.useState(null),[r,n]=i.useState([]),l=e=>{const s=h.get(e);return s&&Date.now()-s.timestamp<18e5?s.data:null},c=(e,s)=>{h.set(e,{data:s,timestamp:Date.now()})},o=i.useCallback(async e=>{const a=(e=>JSON.stringify(e))(e),r=l(a);if(r)return n(r),r;s(!0),t(null);try{const s=new URLSearchParams;e.year&&s.append("year",e.year.toString()),e.discipline&&s.append("discipline",e.discipline),e.limit&&s.append("limit",e.limit.toString()),e.competence&&s.append("competence",e.competence),e.skill&&s.append("skill",e.skill);const t=await fetch(`${u}/questions?${s}`);if(!t.ok)throw new Error(`Erro na API: ${t.status}`);const r=(await t.json()).map((s,a)=>({id:s.id||`q_${e.year}_${a}`,enunciado:s.statement||s.enunciado||"",alternatives:s.alternatives||s.alternativas||[],correctAnswer:s.correctAnswer||s.gabarito||0,year:s.year||e.year||2023,discipline:s.discipline||e.discipline||"geral",competence:s.competence||s.competencia,skill:s.skill||s.habilidade,image:s.image||s.imagem,context:s.context||s.contexto}));return n(r),c(a,r),r}catch(i){const e=i instanceof Error?i.message:"Erro desconhecido";return t(e),[]}finally{s(!1)}},[]),d=i.useCallback(async e=>{const{ano:s,disciplina:a,tipo:t,limite:r}=e;let i=[],n=0,l=0;try{if("completo"===t){const e=["matematica","ciencias-natureza","ciencias-humanas","linguagens"];n=330,l=180;for(const a of e){const e=await o({year:s,discipline:a,limit:45});i.push(...e.slice(0,45))}}else if("por_disciplina"===t&&a)n=90,l=45,i=await o({year:s,discipline:a,limit:45});else if("personalizado"===t){const e=r||20;n=Math.ceil(2.5*e),l=e,i=await o({year:s,discipline:a,limit:e})}const e=i.sort(()=>Math.random()-.5).slice(0,l);return{id:`simulado_${s}_${t}_${Date.now()}`,titulo:a?`ENEM ${s} - ${a.charAt(0).toUpperCase()+a.slice(1)}`:`ENEM ${s} - Simulado ${"completo"===t?"Completo":"Personalizado"}`,ano:s,disciplina:a,questoes:e,tempoLimite:n,tipo:t,totalQuestoes:e.length}}catch(c){throw new Error("Falha ao gerar simulado")}},[o]),m=i.useCallback(async()=>{const e="anos_disponiveis",s=l(e);if(s)return s;try{const s=await fetch(`${u}/exams`);if(!s.ok)throw new Error("Erro ao buscar anos");const a=(await s.json()).map(e=>e.year).sort((e,s)=>s-e);return c(e,a),a}catch(a){return[2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009]}},[]),x=i.useCallback(async()=>["matematica","ciencias-natureza","ciencias-humanas","linguagens"],[]);return{loading:e,error:a,questoes:r,buscarQuestoes:o,gerarSimulado:d,listarAnos:m,listarDisciplinas:x}},j={matematica:"Matemática","ciencias-natureza":"Ciências da Natureza","ciencias-humanas":"Ciências Humanas",linguagens:"Linguagens"};function g(){const{loading:u,error:h,questoes:g,buscarQuestoes:f,listarAnos:N,listarDisciplinas:b}=p(),[v,w]=i.useState(0),[y,C]=i.useState(null),[S,E]=i.useState(!1),[A,k]=i.useState(0),[$,M]=i.useState(0),[z,q]=i.useState([]),[Q,_]=i.useState([]),[D,L]=i.useState({ano:void 0,disciplina:void 0,limite:20}),I=120,[P,B]=i.useState(I);i.useEffect(()=>{(async()=>{const e=await N(),s=await b();q(e),_(s);const a=e?.[0],t=s?.[0];L(e=>({...e,ano:a,disciplina:t})),await f({year:a,discipline:t,limit:D.limite}),w(0),B(I),C(null),E(!1),k(0),M(0)})()},[]),i.useEffect(()=>{if(P>0&&!S){const e=setTimeout(()=>B(e=>e-1),1e3);return()=>clearTimeout(e)}0!==P||S||(M(e=>e+1),E(!0))},[P,S]);const F=g[v];return e.jsxs("div",{className:"min-h-screen bg-background p-6",children:[A+$>=10&&e.jsx(x,{}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Banco de Questões ENEM"}),e.jsx("p",{className:"text-muted-foreground",children:g.length>0?`Questão ${v+1} de ${g.length}`:"Carregue as questões pelos filtros abaixo"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(n,{variant:"outline",className:"text-lg",children:[e.jsx(s,{className:"mr-2 h-4 w-4 text-green-600"}),A," acertos"]}),e.jsxs(n,{variant:"outline",className:"text-lg",children:[e.jsx(a,{className:"mr-2 h-4 w-4 text-red-600"}),$," erros"]})]})]}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(o,{children:"Filtros"})}),e.jsxs(d,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Ano"}),e.jsx("select",{className:"w-full p-2 border rounded-md",value:D.ano??"",onChange:e=>L({...D,ano:Number(e.target.value)}),children:z.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Disciplina"}),e.jsx("select",{className:"w-full p-2 border rounded-md",value:D.disciplina??"",onChange:e=>L({...D,disciplina:e.target.value}),children:Q.map(s=>e.jsx("option",{value:s,children:j[s]??s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Limite"}),e.jsx("input",{type:"number",min:5,max:100,value:D.limite,className:"w-full p-2 border rounded-md",onChange:e=>L({...D,limite:Number(e.target.value)})})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(m,{className:"w-full",onClick:async()=>{await f({year:D.ano,discipline:D.disciplina,limit:D.limite}),w(0),B(I),C(null),E(!1),k(0),M(0)},disabled:u,children:u?"Carregando...":"Carregar Questões"})})]}),h&&e.jsxs("p",{className:"text-sm text-destructive mt-2",children:["Erro ao carregar: ",h]})]})]}),F&&e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(n,{variant:"outline",children:j[F.discipline]||"Geral"}),e.jsxs(n,{variant:"secondary",children:["ENEM ",F.year]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-bold "+(P<=30?"text-red-600":""),children:[P,"s"]})]})]})}),e.jsxs(d,{className:"space-y-6",children:[e.jsxs("div",{className:"prose max-w-none",children:[e.jsx("h3",{className:"text-lg font-medium leading-relaxed",children:F.enunciado}),F.context&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:F.context})]}),F.image&&e.jsx("img",{src:F.image,alt:"Imagem da questão",className:"rounded-lg border"}),e.jsx("div",{className:"space-y-3",children:(F.alternatives||[]).map((t,r)=>e.jsx(m,{variant:"outline",className:"w-full justify-start h-auto p-4 text-left "+(S?r===F.correctAnswer?"border-green-500 bg-green-50 text-green-800":y===r?"border-red-500 bg-red-50 text-red-800":"":y===r?"border-primary bg-primary/10":"hover;border-primary/50"),onClick:()=>!S&&C(r),disabled:S,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center text-sm font-medium "+(S?r===F.correctAnswer?"border-green-500 bg-green-500 text-white":y===r?"border-red-500 bg-red-500 text-white":"border-gray-300":y===r?"border-primary bg-primary text-white":"border-gray-300"),children:String.fromCharCode(65+r)}),e.jsx("span",{className:"flex-1",children:t}),S&&r===F.correctAnswer&&e.jsx(s,{className:"h-5 w-5 text-green-600"}),S&&y===r&&r!==F.correctAnswer&&e.jsx(a,{className:"h-5 w-5 text-red-600"})]})},r))}),S&&e.jsx(l,{className:"border-primary/20 bg-primary/5",children:e.jsxs(d,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold text-primary mb-2",children:"Gabarito:"}),e.jsxs("p",{className:"text-foreground",children:["Letra ",String.fromCharCode(65+(F.correctAnswer??0))," — ",(F.alternatives||[])[F.correctAnswer??0]||"Alternativa"]})]})}),e.jsxs("div",{className:"flex gap-3",children:[S?e.jsx(m,{onClick:()=>{if(v<g.length-1){w(v+1),C(null),E(!1),B(I)}else alert(`Sessão finalizada! Acertos: ${A+(y===g[v]?.correctAnswer?1:0)}, Erros: ${$}`)},className:"flex-1",children:v<g.length-1?"Próxima Questão":"Finalizar Sessão"}):e.jsx(m,{onClick:()=>{if(null===y)return;const e=g[v];e&&(y===e.correctAnswer?k(e=>e+1):M(e=>e+1),E(!0))},disabled:null===y,className:"flex-1",children:"Responder"}),e.jsx(m,{variant:"outline",onClick:()=>{w(0),C(null),E(!1),k(0),M(0),B(I)},children:"Reiniciar"})]})]})]}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(o,{children:"Estatísticas da Sessão"})}),e.jsx(d,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(s,{className:"h-8 w-8 mx-auto mb-2 text-green-600"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:A}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Acertos"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(a,{className:"h-8 w-8 mx-auto mb-2 text-red-600"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:$}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Erros"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(r,{className:"h-8 w-8 mx-auto mb-2 text-primary"}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[A+$>0?Math.round(A/(A+$)*100):0,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Taxa de Acerto"})]})]})})]})]})]})}export{g as default};
